# Virtual Pointer Exploit Test Suite

Defenses such as LLVM-CFI and CFIXX attempt to prevent virtual table hijacking attacks. This test suite can be used to benchmark the effectiveness of these defense mechanisms against such attacks.


# Overview

Test cases cover a range of different attack scenarios and include variations of each attack scenario in different memory locations or type of class hierarchy for the involved objects. The test program takes in five arguments that specify a unique attack signature:

```
$ ./test <memory location> <class hierarchy> <type> <pointer> <vtable>  
```

## Memory Location

`<memory location>` specifies in which memory region the attack is carried out. It has 3 possible inputs:

1. `heap`
2. `stack`
3. `global`

## Class Heirarchy

`<class heirarchy>` refers to the relationship between the objects used in the attack. It has 3 possible inputs:

1. `independent`
2. `inherited`

## Type

`<type>` refers to the type of attack that will be carried out and has 4 possible inputs:

1. `object_bounds_overflow`
2. `sub_object_bounds_overflow`
3. `type_confusion`
4. `use_after_free`
5. `fake_object`

## Pointer

`<pointer>` determines which pointer the exploit is going to target and has two possible inputs:

1. `vptr` : the exploit will overwrite the vptr in an object
2. `object_ptr` : the exploit changes the pointer to the object

## Vtable  

`<vtable>` determines the location of the vtable that the overwritten vptr points to(if any). It has 3 possible inputs:

1. `reuse` : a vtable from an existing object is used
2. `injection` : a fake vtable is created and pointed to
3. `corruption`

# Build and Run

1. Compile test.cpp with the defense mechanism to be benchmarked. For example, to test LLVM-CFI:

```
clang++-5.0 test.cpp -o test_cfi -flto -fsanitize=cfi -fvisibility=hidden -std=c++17

```

2. Run driver script that will execute the test program with all possible attack signatures. The driver script requires an argument specifying the executable test's filename:
```
/bin/bash test_driver.sh test_cfi

```

Default compiler example:

```
$ clang++-5.0 test.cpp -o test -std=c++17 -O2
$ /bin/bash test_driver.sh test

```

# Attack Directory

The implementation of each exploit is given here:

* heap
    * independent
        * object_bounds_overflow
            * vptr
                * reuse
                    ```
                    $ ./hijack heap independent object_bounds_overflow vptr reuse
                    ```
                    **DONE (1)**
                * injection
                    ```
                    $ ./hijack heap independent object_bounds_overflow vptr injection
                    ```
                    **DONE (13)**
                * corruption

            * object_ptr  
                  **Not possible? Independent objects.**  

        * sub_object_bounds_overflow
            * vptr
                * reuse
                    ```
                    $ ./hijack heap independent sub_object_bounds_overflow vptr reuse
                    ```
                    **DONE (2)**
                * injection
                    ```
                    $ ./hijack heap independent sub_object_bounds_overflow vptr injection
                    ```
                    **DONE (14)**
                * corruption
            * object_ptr  
                **Not possible? Independent objects.**  

        * type_confusion
            * vptr
                * reuse
                    ```
                    $ ./hijack heap independent type_confusion vptr reuse
                    ```
                    **DONE (3)**
                * injection
                    ```
                    $ ./hijack heap independent type_confusion vptr injection
                    ```
                    **DONE (15)**
                * corruption
            * object_ptr
                **Not possible? Independent objects.**  

        * use_after_free
            * vptr
                * reuse
                    ```
                    $ ./hijack heap independent use_after_free vptr reuse
                    ```
                    **DONE (4)**
                * injection
                    ```
                    $ ./hijack heap independent use_after_free vptr injection
                    ```
                    **DONE (16)**
                * corruption
            * object_ptr
                **Not possible? Independent objects.**  

    * inherited
        * object_bounds_overflow
            * vptr
                * reuse
                    ```
                    $ ./hijack heap inherited object_bounds_overflow vptr reuse
                    ```
                    **DONE (17)**
                * injection
                * corruption
            * object_ptr
        * sub_object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
                ```
                $ ./hijack heap inherited type_confusion object_ptr
                ```
                **DONE (5)**
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
                ```
                $ ./hijack heap inherited use_after_free object_ptr
                ```
                **DONE (6)**
    * multiple_inheritance
        * object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * sub_object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr

* stack
    * independent
        * object_bounds_overflow
            * vptr
                * reuse
                    ```
                    $ ./hijack stack independent object_bounds_overflow vptr reuse
                    ```
                    **DONE (7)**
                * injection
                * corruption
            * object_ptr
        * sub_object_bounds_overflow
            * vptr
                * reuse
                    ```
                    $ ./hijack stack independent sub_object_bounds_overflow vptr reuse
                    ```
                    **DONE (8)**
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                    ```
                    $ ./hijack stack independent type_confusion vptr reuse
                    ```
                    **DONE (9)**
                * injection
                * corruption
            * object_ptr
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
    * inherited
        * object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
                ```
                $ ./hijack stack inherited object_bounds_overflow object_ptr
                ```
                **DONE (10)**
        * sub_object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
                ```
                $ ./hijack stack inherited type_confusion object_ptr
                ```
                **DONE (11)**
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
                ```
                $ ./hijack stack inherited use_after_free object_ptr
                ```
                **DONE (12)**
    * multiple_inheritance
        * object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * sub_object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr

* global
    * independent
        * object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * sub_object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
    * inherited
        * object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * sub_object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
    * multiple_inheritance
        * object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * sub_object_bounds_overflow
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * type_confusion
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr
        * use_after_free
            * vptr
                * reuse
                * injection
                * corruption
            * object_ptr

Current Exploit: **17**
